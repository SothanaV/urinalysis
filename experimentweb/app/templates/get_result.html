{% extends 'base.html' %}
{% load staticfiles %}
{% block title %} Get Result {{id}} {% endblock %} 
{% block content %}
<div id="content">
  <br>
  <div class="uk-container">
      <!-- Nev SECTION -->
      <div class="uk-grid">
        <a href={% url 'result' id|add:"-1" %} class="uk-icon-button uk-width-1-4" :uk-icon="'chevron-left'"></a>
        <form class="uk-width-1-4 uk-margin-remove" v-on:submit.prevent="searchurl">
          <input class="uk-input" type="text" placeholder="Search..." v-model.number="searchid" >
        </form>
        <a href={% url 'result' id|add:"+1" %} class="uk-icon-button uk-margin-medium-left uk-width-1-4" :uk-icon="'chevron-right'"></a>
      </div>
      {% if i != "null" %}
        <div class="uk-text-lead">
        <span class="uk-label"> Urine: </span> {{urine}}
        </div>
      {% endif %}
  </div>
  {% if i != "null" %}
    <div class="uk-margin-small-left uk-margin-small-right">
      <canvas id="chart" style="max-height: 1000px; max-width: 100%"></canvas>
    </div>

  {% else %}
    <div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">

    <form class="form-horizontal" method="post" action="/formin/">
      <h3 class="block-center-heading">
        Experiment Parameter
      </h3>
      {% csrf_token %}
      <div class="uk-grid">
        <div class="uk-grid uk-width-1-3" v-for="d in formData">
          <label class="uk-width-1-3"> [[d.label]] </label>
          <input class="uk-width-2-3" :name="d.label" type="number" v-model="d.value" />
        </div>
      </div>
      <br>
      <input class='uk-button' type="submit" value="START" autofocus>
    </form>
  {% endif %}
</div>

<script type='text/javascript' src='{% static "js/Chart.min.js" %}'></script>

<script type='text/javascript'>
  let content = new Vue({
    el: "#content",
    delimiters: ['[[', ']]'],
    data: function() {
      return {
        searchid: {{id}},
        formData: [
          {label: 'vmin', value: 0},
          {label: 'vmax', value: 0},
          {label: 'vcc', value: 0},
          {label: 'pw', value: 0},
          {label: 't', value: 0},
          {label: 'a', value: 0},
          {label: 'e', value: 0},
          {label: 'loop', value: 0}
        ]
      }
    },

    methods: {
      searchurl: function () {
        location.href = "/result/"+this.searchid
      }
    }
  })
  if ( {{i}} ) {
    let i = {{i}}
    let v = {{v}}
    let createTime = "{{create_time}}"
    let ctx = document.getElementById("chart").getContext('2d');
    let resultChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: v,
        datasets: [{ 
            data: i,
            label: "I",
            borderColor: "#3e95cd",
            fill: false
          },
        ]
      },
      options: {
        responsive: true,
        title: {
          display: true,
          text: 'Experiment Result ' + createTime
        },
        legend: {
          display: false
        },
      }
    });
  }
</script>
{% endblock %}